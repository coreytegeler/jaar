"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var App=function(){function App(){_classCallCheck(this,App);this.ua=window.navigator.userAgent.toLowerCase();this.capabilities={isMobile:"matchMedia"in window&&matchMedia("(max-width: 600px)").matches,isAndroid:this.ua.indexOf("android")>=0,isiOS:!!this.ua.match(/iP(ad|od|hone)/i),isFirefox:!!this.ua.match(/firefox/i)};this.init()}_createClass(App,[{key:"getTracks",value:function getTracks(){var tracksArray=[];var tas=document.querySelectorAll("a.track");for(var i=0;i<tas.length;i++){var el=tas[i];el.setAttribute("data-idx",tracksArray.length);tracksArray.push({title:el.innerHTML,url:el.getAttribute("href"),el:el})}return tracksArray}},{key:"init",value:function init(){this.player=new Player(document.getElementById("player"),this.capabilities,this.getTracks())}}]);return App}();var Player=function(){function Player(container,capabilities,tracksObj){_classCallCheck(this,Player);this.tracks=tracksObj;this.currentTrack=false;this.hasLoadedTrack=false;this.capabilities=capabilities;this.container=container;this.labelElt=this.container.querySelector(".track-name");this.init()}_createClass(Player,[{key:"init",value:function init(){this.audio=audiojs.create(this.container.querySelector("audio"),{css:false,createPlayer:{markup:false,playPauseClass:"play-pause",scrubberClass:"scrubber",progressClass:"progress",loaderClass:"loaded",timeClass:"time",durationClass:"duration",playedClass:"played",errorMessageClass:"error-message",playingClass:"playing",loadingClass:"loading",errorClass:"error"},trackEnded:function trackEnded(){this.next()},loadError:function loadError(args){this.label("load error");this.container.querySelector(".audiojs").classList.add("error")}});this.audiojsElt=this.container.querySelector(".audiojs");this.audiojsElt.classList.add("inited");this.enableTrackLinks();this.enablePlayerControls();if(!this.capabilities.isMobile){this.enableKeyControls()}}},{key:"enableTrackLinks",value:function enableTrackLinks(){document.addEventListener("click",function(e){if(e.target.hasAttribute("data-idx")){var idx=parseInt(e.target.getAttribute("data-idx"),10);console.log("clicked on track",idx);this.notPlayingTrack(this.currentTrack);this.playTrack(idx);e.preventDefault();e.stopPropagation()}}.bind(this))}},{key:"label",value:function label(s){this.labelElt.innerHTML=s}},{key:"notPlayingTrack",value:function notPlayingTrack(idx){if(idx===false)return;console.log("notPlayingTrack",idx);var el=document.querySelector('a[data-idx="'+idx+'"]');console.log("notPlayingTrack",el);el.classList.remove("playing")}},{key:"canNavigatePrev",value:function canNavigatePrev(){return this.currentTrack>0}},{key:"canNavigateNext",value:function canNavigateNext(){return this.currentTrack<this.tracks.length-1}},{key:"next",value:function next(e){var userInitiated=typeof e!=="undefined";if(this.canNavigateNext()){this.notPlayingTrack(this.currentTrack);this.playTrack(this.currentTrack+1)}else if(!userInitiated){this.notPlayingTrack(this.currentTrack);this.stop()}}},{key:"prev",value:function prev(e){var userInitiated=typeof e!=="undefined";if(this.canNavigatePrev()){this.notPlayingTrack(this.currentTrack);this.playTrack(this.currentTrack-1)}else{this.audio.skipTo(0)}}},{key:"stop",value:function stop(){this.notPlayingTrack(this.currentTrack);this.audio.pause();this.label("no track");this.audiojsElt.classList.add("no-tracks");this.hasLoadedTrack=false;this.currentTrack=0}},{key:"playTrack",value:function playTrack(trackIndex){console.log("playTrack",trackIndex);console.log(this.tracks[trackIndex].url);if(typeof this.tracks[trackIndex]==="undefined"){return this.stop()}var el=document.querySelector('a[data-idx="'+trackIndex+'"]');el.classList.add("playing");this.hasLoadedTrack=true;this.currentTrack=trackIndex;var track=this.tracks[trackIndex];window.audioInstance=this.audio;this.audio.load(track.url);this.audio.play();this.audiojsElt.classList.remove("no-tracks");this.audiojsElt.classList.add("has-played");this.audiojsElt.classList.toggle("nav-next",this.canNavigateNext());this.audiojsElt.classList.toggle("nav-prev",this.canNavigatePrev());this.label(track.title)}},{key:"playPause",value:function playPause(){console.log("this.playPause");this.audio.playPause();var playing=this.audio.playing;return playing}},{key:"play",value:function play(){console.log("this.play");this.audio.play()}},{key:"pause",value:function pause(){console.log("this.pause");this.audio.pause()}},{key:"enablePlayerControls",value:function enablePlayerControls(){var btns=this.container.querySelectorAll("button");for(var i=0;i<btns.length;i++){btns[i].addEventListener("click",this.onPlayerControlButtonClicked.bind(this))}}},{key:"onPlayerControlButtonClicked",value:function onPlayerControlButtonClicked(e){var btnClass=e.currentTarget.getAttribute("class");console.log(btnClass,"button pressed");switch(btnClass){case"prev":this.prev(e);e.stopPropagation();break;case"next":this.next(e);e.stopPropagation();break}e.preventDefault()}},{key:"enableKeyControls",value:function enableKeyControls(){document.addEventListener("keydown",function(e){console.log("keydown with code",e.keyCode);switch(e.keyCode){case 39:this.next(e);break;case 37:this.prev(e);break}}.bind(this))}},{key:"logTracks",value:function logTracks(){var tracks=t||this.tracks;console.log("Player tracks:",_.map(tracks,function(a){return a.mp3}))}}]);return Player}();var njApp=new App;